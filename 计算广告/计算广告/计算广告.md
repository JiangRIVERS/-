# 计算广告
## 书籍概况
+ 作者：刘鹏 王超
+ 第 2 版
## 读书笔记
## 第1章 在线广告综述
1. 在线广告，也称网络广告、互联网广告，顾名思义，指的是在线媒体上投放的广告。与传统广告不同的是，在线广告在其短短十几年的发展过程中，已经形成了以人群为投放目标、以产品为导向的技术型投放模式。它不仅为广告主带来了以准确接触目标受众为方法论的全新营销渠道，也为互联网免费产品和媒体找到了规模化变现的手段。可以说，不论在做用户产品还是商业产品，不深入了解在线广告，就不可能全面了解互联网业务。因此，互联网行业的从业者花一些时间把现代在线广告原理和产品搞清楚是必需的
2. 计算广告仍然是大数据应用中最成熟、市场规模最大的行业
3. 本章将从两个方面来探讨：一是其内涵，即在线广告这种商业活动的定义与目的；二是其外延，即在线广告发展历史中产生的关键产品形态；另外，本章还有另外一个目的，就是尽可能集中地介绍互联网广告的产品和技术术语，以方便后面的讨论
4. 与线下广告相比，在线广告的产品和创意形式由于互联网媒体在形态、交互方式等方面存在差异，也呈现出各种各样的表现形式
5. 首先，广告不完全等同于搜索或推荐，它首先是一项商业活动，然后才是一项技术；其次，在这一商业活动中，广告主、媒体和用户的利益都需要被认真考虑和满足，这样才能达到整个市场的平衡和不断发展
### 1.1 免费模式与互联网核心资产
1. 免费模式的本质是将那些能够规模化、个性化传播信息的商品，以边际成本的价格出售
2. 当然，这些产品的共同特点是能够传播信息，并且能够对不同用户个性化地传播信息，而像矿泉水、充电器这类无法传播信息的商品，是无法被互联网的免费模式改造的
3. 这类免费产品在传播信息的过程中，获得了3项可变现的核心资产，这就是流量、数据和影响力
  + 流量
  + 数据
  + 影响力。具备影响力的产品或内容在投放广告时可以获得品牌溢价
4. 值得指出的是，近年来迅速崛起的大量网红和自媒体，实际上主要靠影响力而非流量和数据变现
5. 现有的在线广告体系并不能很好地处理这种以影响力为主要资产的媒体变现，这也是未来一个有趣的探索方向
6. 将这3项资产通过商业产品的形式转变为收入的过程，即商业化（monetization）过程，与用户使用免费产品的过程是分离的，因此称为后向变现。从上面的介绍可以看出，无论是数据变现还是影响力变现，都是建立在流量变现的基础上的，而这样的体系也就是计算广告所支撑的、现代的商业化产品体系
### 1.2 大数据与广告的关系
1. 大数据在工业界最显著的特点是区别于以往数据处理系统的低成本、分布式计算架构。从数据来源、处理方式和应用方法这3个角度来看，大数据问题都有明显的特点：
  + 行为数据。传统的数据处理任务往往面对的是交易数据。所谓交易数据指的是商业活动中必须记录的数据，如电信运营商的话费充值、通话记录，银行的存取款、利息等。交易数据处理的规模往往并不太大，但是对一致性和实时性的要求非常高。而商业活动中产生的非必须记录的数据，就是行为数据。电信运营商采集到的用户位置、银行的窗口排队以及网站的用户访问日志等，都属于行为数据。行为数据的加工有两个特点：首先是规模巨大；其次是对一致性的要求要低很多，例如，网站的日志丢失千分之一，往往并不是什么严重的事故
  + 全量加工。如果数据规模很大，并且问题无法通过采样来降低处理的复杂程度，那就必须利用一些专门为海量数据处理而设计的计算和存储技术（如MapReduce、NoSQL数据库等）。全量加工适用于以下两个类型数据：（1）通过数据采样明显降低复杂度，且效果没有明显下降；（2）无法通过处理少量数据达到处理全量数据的效果（推荐、计算广告）
  + 全自动应用。使用数据的应用有两种类型。一种是洞察（insight）应用，即对数据进行统计分析后得到整体的结果报表，再有决策者根据结果进行决策。另外一种是自动化（automation）应用，即将数据处理的结果直接送给对业务进行自动决策的引擎。计算广告正是典型的自动化应用
2. 我们认为，相对于传统的洞察应用，自动化应用才是真正发挥大数据优势的应用形态
3. 由于上述3个特点的存在，催生了Google的GFS、MapReduce和BigTable这”三驾马车“，也产生了Hadoop和Spark等开源技术方案
### 1.3 广告的定义与目的
1. 广告是由已确定的出资人通过各种媒介进行的有关产品（商品、服务和观点）的，通常是有偿的、有组织的、综合的、劝服性的非人员的信息传播活动
2. 出资人、媒体和受众这三者的利益博弈关系是广告活动的主线，这一主线将贯穿于商业和产品形态的整个演化过程。另外，该定义还阐明了广告必须是有偿的、非人员的信息传播活动，这两点限制，前者使广告的目标变得明确，后者使这一目标可以用计算的方式来优化，这些都是计算广告产生的基础
3. 传统广告的目的主要是借助媒体的力量来快速接触大量用户，以达到宣传品牌形象，提升中长期购买率与利润空间的目的。我们称这种目的的广告为品牌广告（brand awareness）。当然，也有许多广告商希望能利用广告手段马上带来大量的购买或其他转化行为，我们称这种目的的广告位直接效果广告（direct response），有时简称为效果广告
4. 传统媒体投送和优化效果广告的能力显然是缺乏的。这是因为，对短期效果的追求要求广告精准地送达目标人群，而这在传统媒体上缺乏有效的技术手段
5. 数字媒体的出现使效果广告空前蓬勃地发展起来：
  + 数字媒体的特点可以让我们低成本地投送个性化广告，这本质上是在变现流量
  + 一些在线服务，如搜索、电子商务，由于可以更清楚地了解用户的意图，也就使广告效果的优化更加容易，这本质上实在变现数据
  + 广告有品牌和效果两种目标
  + 广告的根本目的是广告主通过媒体达到低成本的用户接触
  + 按某种市场意图接触相应的人群，进而影响其中的潜在用户，使他们选择某产品的概率增加，或者对产品性价比的苛求程度降低，这才是广告的根本目的。至于短期内的转化效果，由于市场意图或媒体性质的不同，并不是直接可比的。如果仅仅以转化效果为目的来思考问题，可能会背离投放广告的正确方法论
  + 投入产出比（Return on Investment, ROI）这一评价指标是某次广告活动的总产出与总投入的比例
  + 一切付费的信息、产品或服务的传播渠道，都是广告
### 1.4 在线广告表现形式
1. 下面介绍的各种广告形式概念上有交叠，并不是并列的关系：
  + 横幅广告（banner ad）。这是展示广告中最传统的形式。它是嵌入在页面中的图片，往往需要占据固定大小的版面
  + 文字链广告（textual ad）。这种广告的素材形式是一段链接到广告主落地页的文字，是搜索广告的主流形式，在展示广告中也被广泛采用
  + 富媒体广告（rich media ad）。这类广告利用视觉冲击力较强的表现形式，向用户侵入式地投送广告素材。富媒体广告常见的形式有弹窗、对联、全屏等。它比较适合在高质量的媒体做品牌性质较强的广告投放，但是对用户的使用体验往往影响也较大
  + 视频广告（video ad）。视频广告指的是广告的创意由静态素材变成了一段视频，其信息的传播量和冲击力都得以大大提高。可以说，视频化已经成为在线广告最重要的趋势之一。有关视频广告的效果评价，除了点击率等，还可以采用用户观看时长等更接近用户印象的指标。视频广告的几种形式：
    + 在视频内容播放之前的前插片广告。根据插入位置的不同，视频广告又可以分为前插片、后插片、暂停等类型
    + 在信息流中插入的视频广告。在Wi-Fi场景下往往自动播放，其效果远优于普通的信息流展示广告（例如：抖音下滑视频会滑到的视频广告）
    + 手机游戏中的激励视频广告
  + 交互式广告（playable ad）。在移动应用和游戏推广中，交互创意可以让用户不用下载App就可以体验期内容。交互创意有两种技术方案：一是服务端交互的方案，二是HTML5模拟的方案
  + 社交广告（social ad）。社交网络的兴起给广告传播的渠道和能力都赋予了新的空间。在社交网络中嵌入广告，可以统称为社交广告。它力求在用户的交互过程中尽可能自然地插入广告，被归于原生广告的范畴中。社交广告希望达到的效果是通过用户的扩建式传播获得更大的影响力
  + 移动广告（mobile ad）。在应用中插入广告的SDK和相应的广告产品
  + 邮件营销广告（Email Direct Markting, EDM）这是通过电子邮件向用户推广信息的一种营销手段。与上面的各种广告形式都不同，EDM是一种主动营销方式，可以随时向合适的用户发送信息。对EDM的运营者而言，精准地把握用户兴趣，非常有节制地向用户提供相关信息非常重要
  + 激励广告（incentive ad）。直接激励用户产生转化以提高效果，这类广告称为激励广告。返利购买是电商行业常见的一种推广模式。特别需要注意的是，天下没有免费的午餐，激励广告虽然能显著提高转化效率，但是由于用户的真实需求并不强，因此后续效果会大打折扣，特别是在获取新客户方面的价值比较差，因此，激励广告的价格一般会显著低于非激励广告
  + 团购。团购本质上是一种按照效果付费的泛广告产品
  + 游戏联运。游戏联运是根据用户的最终游戏内消费在推广渠道和游戏开放商之间分成的商业产品，这仍然是一种按效果付费的泛广告产品。实际上，在中国各大Android应用市场，游戏联运的收入远远超过其他类型广告的收入
  + 固定位导航。这主要包括网址导航站的位置输入、应用分发平台的推荐位置等付费推广位置。一般来说，这种产品的销售都采用按时间付费的模式，而不是动态的竞价模式。这是因为广告主除了引流之外，往往更加关注那些入口位置的橱窗效应
2. 通过多种广告形式之间的竞价来决策，这是非常重要的内部流量货币化的运营理念
### 1.5 在线广告简史
1. 在互联网上展示横幅广告的产品形式为展示广告，也称显示广告。我们称上述的展示广告售卖模式为合约广告，即采用广告的方式约定某一广告位在某一时间段为特定广告主所独占，并且根据双方的要求，制定广告创意和投放策略。显然这样的采买模式并没有用到数字媒体可以对不同用户投放不同内容的个性化特征
2. 互联网广告者经过探索，很快就发现了数字媒体不同于传统媒体的本质特点：可以对不同的受众呈现不同的广告创意。实际上，这是在线广告效果和规模不断发展的核心驱动力。并因此衍生出定向广告
3. 在广告业务中，数据变现是依附在流量变现的基础上的
4. 定向广告系统对计算机技术提出了两个需求：一是受众定向（audience targeting），即通过技术手段标定某个用户的性别、年龄或其它标签，二是广告投放（ad serving），即将广告投送由直接嵌入界面变为实时响应前段请求，并动态决策和返回合适的广告创意。此时的定向广告仍然以合约的方式进行：媒体与广告主约定广告位、时间段和投放量，并在此基础上确定合同的总金额以及量未达标的情况下的赔偿方案。这种担保式投送（Guaranteed Delivered,GD）的交易方式逐渐成为互联网合约式广告的主要模式。一般来说，这样的合约仍然主要面向品牌广告主，并且按照千次展示付费（Cost per Mile,CPM）的计费方式
5. GD广告系统中有一个重要的计算问题，即保证满足各合约目标量的要求的同时，尽量为广告主分配到效果更好的流量。这个问题有两个难点：一是如何有效地将流量分配到各个合约相互交叉的人群覆盖上；二是要在在线的环境下实时地完成每一次展示的决策。这个就是在线分配（online allocation）问题。如果将各合约的量看作约束条件，将广告效果看作目标函数，则可以利用带约束优化（constrained optimization）的数学框架来解决
6. 竞价广告（auction-based advertising）。在竞价模式下，供给方只像广告主保证质即单位流量的成本，但不再给出量的保证。对于每一次展示，则按照收益最高这样简单原则来决策
7. 定向广告在”量“的约束下，最优化”质“；由于细粒度标签组合难以准确预估所导致的”质“的下降。同时，由于”量“的约束，某些广告曝光机会会给”量“需求大的广告主，导致浪费卖的更高的流量机会
8. 如何向广告主收取每次竞价费用这一点上，并不是按照微观上最优的方案实施就可以达到整个市场最大的利益。
9. 关于定价机制的深入研究，产生了广义第二高价（Generalized Second Price,GSP）这一竞价重要的理论
10. 基于竞价和准确人群定向这两个核心功能，产生了广告网络（AD Network,ADN）。它批量地运营媒体的广告位，按照人群或上下文标签售卖给需求方，并用竞价的方式分配流量。广告网络的结算方式以按点击付费（Cost per Click,CPC）的方式为主。这种产品的千次展示收益（Revenue per Mille,RPM）一般来说达不到合约广告的水平,但它使大量媒体剩余流量（remnant inventory），即没有能力通过合约售卖的流量，有了可行的变现手段：这些媒体可以直接把自己的库存（inventory）托管给ADN，借助ADN的销售和代理团队让自己的流量变现（解决长尾问题）
11. 竞价广告产生后，流量采买形式发生了变化：一是更多地面向受众而非广告位进行采买；二是越来越需要技术手段保证广告主的要求，并在此基础上优化效果
12. 因为只能在供给方定义好的标签组合上指定出家，而不能控制每一次展示的出价，市场看起来更像一个黑盒子，所以需求方只能靠选择合适的标签组合，以及阶段性调整出价来间接控制效果。这种面向多个ADN或媒体按人群一站式采买广告，并进行量和质优化的需求方产品，称为交易终端（Trading Desk,TD）
13. 广告网络的竞价过程是内部进行的，这无法满足广告主定制化的人群选择和优化要求。这样的需求催生了一种开放的竞价逻辑，让需求方按自己的人群定义来挑选流量，这就是实时竞价（Real Time Biding,RTB），它将竞价过程由广告主预先出价，变成每次展示时实时出价
14. 市场上产生了聚合各媒体流量，采用实时竞价方式进行变现的新产品形态--广告交易平台（AD Exchange,ADX）
15. 通过实时竞价，按照定制化人群标签采买广告，这样的产品就是需求方平台（Demand Side Platform,DSP）
16. 基于DSP的广告采买也叫作程序化交易（programmatic trade）
17. 将内容与广告以某种方式统一决策或展示的产品形式--原生广告（native ad）在近年来得到了越来越多的关注
18. [一图读懂在线广告产品交互关系](https://www.afenxi.com/73902.html)

[计算广告交易平台交互图](https://github.com/JiangRIVERS/ReadingNotes/blob/main/计算广告/计算广告交易平台交互图.jpg)
![image](https://github.com/JiangRIVERS/ReadingNotes/blob/main/计算广告/计算广告交易平台交互图.jpg)
19. 广告发展史分为两条线：
+ 交易形态主线：展示广告->合约广告->竞价广告->实时竞价广告
+ 产品展示逻辑线：广告与内容相互独立->原生广告
## 第二章 计算广告基础
1. 可衡量的效果以及相应的计算优化，是在线广告有别于线下广告的主要特点
2. 计算广告的核心问题：利润优化问题的概念性框架
3. 在大多数广告产品中，可以通过计算优化的主要是收入部分，而千次展示期望收入（expected Cost per Mile,eCPM）正是计算广告中最为核心的量化指标之一
4. eCPM又可以分解为点击率和点击价值的乘积
### 2.1 广告有效性理论
1. 广告的信息接收过程分为3个大阶段，即选择（selection）、解释（interpretation）与态度（attitude），或者进一步分解为6个子阶段，即曝光（exposure）、关注（attention）、理解（comprehension）、接受（acceptence）、保持（retention）与决策（decision）。
+ 曝光阶段。这一阶段指的是广告物理上展现出来的过程，其有效程度往往与广告位的物理属性有关，并没有太多可以通过技术优化的空间。实际的广告实践中，因为曝光的有效性对最终结果的影响往往远远高于其他技术性因素，所以才会有“位置为王”的说法。
+ 关注阶段。这一阶段指的是受众从物理上接触到广告，到意识上关注到它的过程。对广告而言，曝光不一定意味着关注。强曝光并不能等同于用户有效的关注。如何提高关注阶段的效率呢？
  + 首先，尽量不要打断用户的任务。用户明确辨识出某个固定的广告位，并且不再认为它与当前网页的任务有关联时，他会下意识地屏蔽其内容
  + 其次，明确传达向用户推送此广告的原因，这一点是受众定向广告创意优化的重要方向
  + 最后，内容符合用户的兴趣或需求，这是行为定向的原理基础
+ 理解阶段。用户关注到了刚搞的内容并不意味着他一定能理解广告传达的信息。如何提高理解阶段的效率呢？
  + 首先，广告内容要在用户能理解的具体兴趣范围内
  + 其次，要注意设定与关注程度相匹配的理解门槛。例如，在电视广告中，可以用一定情节的短故事来宣传品牌；在路牌广告中，创意制作的原则是将若干主要市场诉求都表达出来；而对互联网广告，由于用户的关注程度非常低，我们应该集中强调一个主要诉求以吸引用户的注意力
+ 接受阶段。受众理解了广告传达的信息，并不表示他认可这些信息。在使用幽默、性感这样非常规的广告手段时，要特别注意这一点。广告的上下文环境对广告的接受程度有着很大的影响，同一广告出现在某游戏社区上和门户网站首页上，用户会更倾向于后者更具说服力，这也就是优质媒体的品牌价值
+ 保持阶段。对于追求长期效果的品牌广告商，当然希望广告传达的信息给用户留下鲜明的记忆，以长时间影响他的选择
+ 决策阶段。成功广告的最终作用是带来用户的转化行为，虽然这一阶段已经离开了广告的业务范围，但好的广告还是能够为转化率的提高做好铺垫的

定型地说，越靠前的阶段，其效果对点击率的影响越大；越靠后的阶段，其效果对转化率的影响越大。
### 2.2 互联网广告的技术特点
1. 在线广告不同于传统广告的特点有如下几点：
+ 技术和计算导向。数字媒体的特点使在线广告可以进行精细的受众定向，而技术又使得广告决策和交易朝着计算驱动的方向发展
+ 效果的可衡量性。点击率绝对值得比较没有那么重要，而在一个特定时期不同广告和算法表现出来的差异，才是更有意义的
+ 创意和投放方式的标准化。标准化的驱动力来自于受众定向与程序化交易。既然需求方关心的是人群而非广告位，创意尺寸的统一化与一些关键接口标准化非常关键。在PC广告市场，有越来越多的广告平台愿意根据这些标准来设计自己的产品，因为这样大家可以充分利用整个市场的流动性，更快地创造价值。不过，在移动时代，与内容表现一致的原生化需求比创意的标准化需求更加急迫。因此，移动时代的创意标准可能会有完全不同的思路
+ 媒体概念的多样化。在从需求方看在线广告时，应该注重各种性质媒体的配合关系，并从整合营销的角度去审视和优化整体效果。既注重“转化”，又注重“引导”潜在用户。试想，如果一家电商只用返利网作为线上广告渠道，ROI一定可以做到很高，但是这样的营销能够给他带来大量潜在用户吗？答案是不能。2012年底，淘宝发布声明，宣布终止与以现金形式返利的淘宝客网站的合作，正是放映了市场对此问题的认知正在趋向一致和理性
+ 数据驱动的投放决策。广泛收集用户的行为数据和广告反馈数据，利用云计算的基础设施对用户打上合适的标签，同样根据数据在多个广告竞争同一次展示时作出决策，再将投放的结果统计数据反馈给广告操作人员以调整投放策略，这已经成为在线广告的基本投放逻辑
### 2.3 计算广告的核心问题
1. Andrei Broder在提出计算广告这一课题的同时，给出了其核心研究挑战：“Find the best match between a given user in a given context and a suitable advertisement”。本书对这一表述少做加工，给出计算广告的核心问题如下：

```
计算广告的核心问题，是为一系列用户与上下文的组合找到最合适的广告投放策略以优化整体广告活动的利润
```

本书做了以下两个调整：
+ 首先，强调广告问题优化的是一组展示上的效果，而孤立的某一次展示上的效果。这是由于广告活动中普遍存在着量的约束，在这一约束下优化利润，其最优解往往与每次展示独立决策时有很大的不同
+ 其次，描述中去除了“given”字眼，这是由于在某些广告产品中，系统并不一定能拿到确定的用户或上下文唯一标识，但这并不意味着无法进行计算优化。同样我们也强调优化的结果是“广告投放策略”而不一定是具体的广告，这也是因为有些产品的策略并不是直接决定最后展示的。

2. 计算广告核心挑战可以用一个最优化问题来表达：

```math
max\sum_{i=1}^{r}(r_i-q_i)\quad s.t.\quad \sum_{r=i}^{r}d_ik\le D_k, \forall k
```
其中i为展示次数；ri为收入；qi为成本；dik为限制条件。如预算。
进一步考虑收入与成本具体依赖的因素，上面的优化问题可以写成：
```math
max\sum_{i=1}{r}\lbrace r(a_i, u_i, c_i)-q(a_i, u_i, c_i)\rbrace \quad s.t. \quad \sum_{i=1}^{r}d(a_i, u_i, c_i) \le D_k, \forall k
```
其中的a, u, c 这3个变量分别代表广告、用户与上下文，即广告活动的3个参与主体。实际上，对除DSP以外的大多数广告产品来说，要么是自营或包断资源，要么按以收定支的方式与媒体分成，其成本也对应为常数或正比于收入，在这种情况下，成本部分可以从上面的优化公式中去掉。在约束中，每次约束产生的成本d除了与a, u, c有关，还与具体某个广告主k有关
在具体的广告产品中，油化工是可能会省略掉一些内容或参数
### 2.3.1 广告收入的分解
1. 对一个广告市场中具体的产品形态，能够主动优化的往往是收入而非成本
2. 在一次广告展示产生后，有可能发生以下后续行为：
+ 点击行为。广告点击与广告展现的比率称为点击率（Click Through Rate, CTR）
+ 点击行为成功以后，将会打开广告主的落地页（landing page），落地页成功打开次数与点击次数的比例称为达到率
+ 如果用户从落地页开始，进一步完成下单等操作，则称为转化，转化次数与到达次数的比例称为转化率（Conversion Rate, CVR）
3. 按照媒体网站和广告主网站上的行为对收入r进行分解，是实践中比较合理且容易操作的方式：
```math
eCPM = r(a, u, c) = \mu(a, u, c)\cdot\nu(a, u, c)
```
\mu 和 \nu 两个参数分别表示点击率和点击价值（click value）
3. 在对多个候选排序时，是根据eCPM还是CTR排序，也是区别广告产品和用户产品的重要策略特征。进一步，如果我们将所有的点击价值都等同起来，那么根据eCPM和根据CTR排序实际上将得到一样的结果。因此，可以认为根据CTR排序是根据eCPM排序的一种特例，这也使得将内容与广告同一排序的原生广告称为可能。
4. eCPM一般指的是估计的千次展示收益，它有两个很相近的概念：如果讨论的是千次展示收入，往往用RPM；如果讨论的是千次展示成本，往往用CPM。RPM和eCPM两个术语经常是一样的，但它们被用于不同的上下文中
### 2.3.2 结算方式与eCPM估计的关系
```
以游戏广告为例，CPM为广告展示给用户计费；CPC为用户点击广告收费；CPA为用户激活收费（即用户注册、开始玩游戏）；CPS为分成，即用户消费后收费
```

1. 根据eCPM的分解决定哪部分由谁来估计是广告市场各种计费模式产生的根本原因，也是广告市场中商业逻辑与产品架构衔接的关键一环：
+ CPT(Cost Per Time)结算。这是将某个广告位以独占方式交给某广告主，并按独占时间段收取费用的方式。这种方式主要适用于一些强曝光属性、有一定定制性的广告位。CPT这种独占方式的售卖虽然有一些额外的品牌效果和橱窗效应产生，但是非常不利于受众定向和程序化交易的发展，因此长期看来比例会有下降的趋势
+ CPM(Cost per Mile)结算。即按照千次（mile）展示计算，这里的“mile”是拉丁文“千次”的意思。这种方式是供给方与需求方约定好的千次展示的计费标准，至于这些展示是否能带来相应的收益，由需求方来估计和控制其中的风险。对于品牌广告，由于目标是较长时间内的回报，很难通过短期数据反馈直接计算点击价值，而点击率也因为对于用户接触的核心要求变得不是唯一重要的因素。实际上，在大多数互联网品牌广告、特别是视频广告中，CPM都是主流的结算方式
+ CPC(Cost per Click)结算。即按点击计算。这种方式最早产生于搜索广告，并很快为多数效果类广告普遍采用。以CPC方式结算，在效果类广告市场中具有接近垄断的地位
+ CPS（Cost per Sale）/CPA(Cost per Action)/ROI结算，即按照订单销售、转化行为或投入产出比来结算，这些都是按照转化付费的一些变种。在这种结算方式下，供给方或中间市场除了估算点击率，还要对点击价值作出估计，这样才能合理地决定流量分配。这里存在一个明显的问题：转化是用户在广告商站内的行为，并非供给方能够直接检测和控制，也无法进行准去的估计和优化。因此，只有那些转化流程和用户体验类似的广告商组成的广告平台，按转化付费才比较可行，典型的例子就是淘宝客广告（转化流程都发生在淘宝上）和移动应用下载广告（转化流程都发生在App Store或Google Pay中）。筒体而言，对于与广告主收益直接挂钩的需求方产品来说，CPS在一定条件下是可行的；但是对于普通的中间广告市场来说，CPS并不是一种最合理的结算方式。CPA结算的广告中有两种特殊的类型：
  + 一类是某些收集线索的直接效果广告，按照收集到的线索数结算。（用一搜索潜在用户名单多少来收费。即每次通过特定链接，注册成功后付费的一个常见广告模式。这是我们通常称为的引导注册），这称为 CPL（Cost oer Lead）方式
  + 另一类是移动应用下载的直接效果广告，按照安装数结算，这称为CPI（Cost per Install）方式
+ oCPM（optimized CPM）结算。oCPM是Facebook主推的一种新结算方式，意思是广告平台仍然按照CPM结算费用，但会根据转化率进行优化。也就是说，虽然结算方式仍然是CPM，但是供给方会承诺点击率和点击价值估计的任务。实际中，oCPM往往是向某个广告主提供CPA结算之前的一种过渡方式
2. 以上在线广告结算方式可以总结为下表：

|结算方式|点击率估计|点击价值估计|优缺点|适用场景|
|---|---|---|---|---|
|CPT|需求方|需求方|可以充分发挥橱窗效应，无法利用受众定向技术|高曝光的品牌广告|
|CPM|需求方|需求方|可利用受众定向选择目标人群，合约售卖下受众划分不能过细|有受众选择需求的品牌广告、实时竞价广告交易|
|CPC|供给方|需求方|可以精细化分受众人群，合理的供给方和需求方分工|竞价广告网络|
|CPS/CPA/ROI|供给方|供给方|需求方无任何风险，供给方运营难度大|效果类广告联盟、效果类DSP|
|oCPM|供给方|供给方|向CPA方式的稳健过渡|数据收集能力强的广告平台|

3. 在CPM类品牌广告中，由于曝光在媒体上产生，广告主往往会委托第三方的广告监测公司对曝光量、点击量等指标作技术核实，并以此作为结算的依据。在CPC或CPS的广告交易中，由于计费的指标，即点击或转化，在广告主的网站上产生，所以并不需要特别的监测服务。因此，可以认为广告监测的主要服务对象是品牌广告主。
### 2.4 在线广告相关行业协会
1. 由于供给方和需求方的博弈关系，需要一些行业协会来约束和规范市场
### 2.4.1 交互广告局（供给方）
1. 交互广告局（Interactive Advertising Bureau, IAB）主要关注的是在线广告供给方的利益
2. IAB包含如下重要的规范：
  + 展示广告创意尺寸标准。创意尺寸的统一化，对于在线广告淡化广告位概念、推广受众定向有着非常根本的促进作用。中国市场与此对比，由于广告位尺寸非常复杂，因而各个网站之间壁垒较高，非常不利于定向广告和程序采买的发展。
  + 视频广告标准VAST（digital video ad serving template）。这一标准实际上减少了进入视频广告领域的技术障碍，使得视频广告市场规模快速发展成为可能
  + 通用实时竞价接口标准OpenRTB。这种采买方式是为了方便需求方按照自己的受众划分高精准地才买流量
### 2.4.1 美国广告代理协会
美国广告代理协会（American Association of Advertising Agencies, 简称4A）。4A公司向其会员代理公司约定，至少要向广告主收取一定比例的服务费用，这一方面是为了避免行业内的恶性竞争，另一方面也是确保广告代理公司能够站在广告主的理解角度考虑问题
### 2.4.3 美国国家广告协会
美国国家广告商协会（Association of National Advertisers, ANA）是一个广告主的协会，也是最彻底地代表需求方利益的组织
## 第3章 在线广告产品概述
1. [在线广告产品进化示意](https://github.com/JiangRIVERS/ReadingNotes/blob/main/计算广告/在线广告产品进化示意.jpeg)

![image](https://github.com/JiangRIVERS/ReadingNotes/blob/main/计算广告/在线广告产品进化示意.jpeg)

2. 在线广告产品的发展历程，表面上看是广告产品和市场本身的进化，实际上是由于数据利用和变现需求的推动
3. 我们将在线广告产品的发展历程分为4个阶段：
  + 合约广告产品。可分为按时间段售卖的CPT广告和按照约定展示量售卖的CPM广告。这类广告产品主要服务于后续效果不宜直接衡量的品牌类广告主，在门户网站和视频网站较为常见。保量CPM广告产生的原动力是数据变现的需要。不过由于合约中量的约束的存在，它能够变现的往往只是人口数形这类规模较大的数据
  + 竞价广告产品。它的最重要的形式是搜索广告。这种广告在拓展到站外展示广告流量时，演进成了对页面关键词或者用户标签竞价的产品形式，也就是ADN。竞价广告的商业逻辑与合约广告完全不同，也是解决效果类广告需求的关键产品形式。竞价广告产生的根本原因是为了变现诸如关键词、精细化用户标签等高价值但量不大的数据，从合约中放弃量的保证以后的效果
  + 程序化交易广告产品。竞价广告的进一步发展催生了实时竞价的交易形式。实时竞价是的需求方可以更灵活地划分和选择自己的目标受众，也使得更广泛的数据使用和交易迅速发展起来。以实时竞价为核心的一系列交易方式逐渐演变为机器之间以程序化的方式完成广告交易决策，因此，这类广告称为程序化交易广告产品。程序化交易的主要推动力是市场中的广告主数据和第三方数据的使用与变现，同时它也催生了于此相关的数据交易市场
  + 原生广告产品。原生广告产品让广告与内容尽可能以“原生”的方式共存。原生广告更加重视场景数据的加工和使用，这也代表了移动时代的新问题和新思路
4. 每一种广告产品基本都有3个组成部分，即面向需求方的接口、面向供给方的接口以及中间的投放系统即匹配策略。这些广告中的产品环节，都属于商业产品的范畴
### 3.1 商业产品的设计原则
1. 商业产品指的是面向商业客户而非一般用户的产品，其中起典型的代表就是在线广告。其他的一些面向用户的互联网产品，如客户关系管理（Customer Relation Management, CRM）、网站分析（Web Analytics, WA），以及后面要提到的数据管理平台（Data Management Platform, DMP）等，都属于商业产品的范畴
2. 用户产品演进的根本驱动力，是人们追求方便的天性。因此，用户产品的设计原则总是朝着更简单、更直观、更快捷的方向努力。而相应的产品设计重点也集中在关键功能的突出、操作过程的流畅等方面
3. 商业产品一般都有一个明确的商业目标，而使用者的动力也是为了优化这个商业目标
4. Facebook的广告之所以为大量的中小广告主广泛采用，主要原因并不是因为使用快捷性远超同类产品，而是因为其推广效果有目共睹。因此，商业产品的任何一项功能改进，只要能带来其对应商业目标的上升机会，即使在使用流程上引入一些不便，也是可以接受的
5. 在优化既定商业目标这一商业产品的总体原则下，商业产品运营中还有一些需要注意的关键点如下：
  + 相对于产品功能，要特别关注产品中的策略部分 
  + 要特别关注数据，让运营和产品优化形成闭环。从数据分析开始，以数据结束，这样的闭环迭代是最适合商业产品的开发模式
  + 当然在所有与使用者打交道的产品界面上，用户产品追求便捷性的设计原则依然非常重要。不过在商业产品中，实现功能以外过于新奇、炫酷的产品外观和交互模式，是应当避免的
### 3.2 广告系统的产品接口
### 3.2.1 广告主层级组织与偷偷放管理
1. 广告市场非常复杂，广告系统的需求方可能是广告主、代理公司、TD（面向多个ADN或媒体，按人群一站式采买广告，并进行量和质的优化的需求方产品，称为交易终端（Trading Desk, TD））或DSP
2. 一般来说，需求方提供的广告是分层次管理的。在多数产品中，广告的层次分为广告主、广告（推广）计划（campaign）、广告（推广）组（ad group）、广告创意（creative）等几个层级

[广告层级关系示意](https://github.com/JiangRIVERS/ReadingNotes/blob/main/计算广告/广告层级关系示意.jpeg)

![image](https://github.com/JiangRIVERS/ReadingNotes/blob/main/计算广告/广告层级关系示意.jpeg)

3. 广告主层级管理一个广告主的通用信息，而其他3个层级则与具体的投放管理有关：
  + 广告计划概念上对应于广告主的一次投放合同，其中包括预算、时间范围等等基本信息：
    + 在有多个广告产品可供选择时，要在广告计划中确定投放的是哪个产品
    + 预算分配策略
  + 广告组对应一个具体的广告投放策略，主要设定受众定向条件和出价。广告组最重要的功能是设置各种各样的定向条件，因而是广告效果优化的关键层级。另外，对媒体的选择也可以认为是一种定向条件
  + 广告创意则是最终展示出来的素材，可能在同一组策略下有不同尺寸的创意存在
### 3.2.2 供给方管理接口
1. 供给端的资源组织主要分为媒体和广告位两个层次，其中媒体可以是网站，也可以是移动应用开发者
2. 媒体的操作比广告主方要简单，一般来说，添加和删除广告位以及查看各广告位的运营数据是主要的功能需求
3. 某个具体广告位，根据产品功能的不同，需要的操作功能也不同，但一般来说，设定广告位尺寸、获取广告投放代码或SDK，设定该广告位对广告类型的要求，是一般通用的需求
4. 广告平台会维护各个广告位对应的域名或用户名，以防其他域名的流量盗用广告位代码
### 3.2.3 供需之间多种接口形式
[供需之间的各种接口](https://github.com/JiangRIVERS/ReadingNotes/blob/main/计算广告/供需之间的各种接口.jpeg)

![image](https://github.com/JiangRIVERS/ReadingNotes/blob/main/计算广告/供需之间的各种接口.jpeg)
1. 负责变现的供给方广告产品有三种方式从媒体处对接流量：
  + 对于Web/WAP 类网页媒体，可以在媒体页嵌入JavaScript代码，向供给方服务器发起广告请求并完成渲染。内嵌HTML5网页的移动应用也可以采用这种方式
  + 对于原生代码实现的iOS/Android应用，需要在应用中集成供给方的SDK，其功能与网页上的JavaScript代码基本一致。但是，由于SDK的体积较大，而且可能带来应用崩溃的情况，因此在集成和测试上工作量较大
  + 有的媒体对集成SDK或JavaScript代码有较大的顾虑，会采用API的方式对接
2. 负责投放广告的供给方或需求方产品也有3种对接广告主的投放需求
  + 最常见的投放方式是广告主通过一个用户界面用人工的方式管理投放和优化效果
  + 当广告主的投放很复杂（如要设定大量关键词）或者需要自动调整优化时，广告平台会提供与界面功能相对应的API接口，以便需求方用编程的方式进行批量投放和优化。注意，这里的API传送的是广告投放的设置条件，而上面供给方与媒体之间的API传送的是广告请求的结果，两者是完全不同的
  + 当某些特殊的广告投放需要自动对接广告主的商品和用户行为，典型的例子如面向电商客户的个性化重定向。在这种情形下，3. 需求方产品一般也要在广告主页面中嵌入JavaSctipt，并根据JavaScript代码收集到的用户数据行为进行广告决策
+ 供给方产品和需求方产品之间也有对接需求，最常见的方式有以下两种：
  + API对接方式
  + 程序化交易的RTB或其类似方式。RTB方式与API方式的主要区别在于，除返回广告信息之外，需求方还会给出报价，当然，这是非常本质的区别
4. 从媒体到广告的端到端来看，每次广告请求决策过程中的S2S过程一般不能多于一次，否则会带来用户端延迟的明显上升，从而影响广告效果。不过，在移动原生应用中的广告，由于客户端可以做缓存，这一限制就没有那么重要
## 第4章 合约广告
1. 合约广告的重要形式是按CPM计费的展示量合约。这种方式仍然用合同约定确定一次广告活动的投放总量和展示单价，但是售卖的对象已经由”广告位“进化到了”广告位+人群“。可以说，因为数据也被直接应用在广告售卖中，所以这是在线广告发展史上的一个重要里程碑
2. 按CPM售卖的展示量合约广告直接催生了受众定向技术
3. 在合约广告，需求方的产品技术并没有太大发展。这是因为广告投放的要求都以合约的形式交由供给方来完成了，需求方并没有太大的优化的空间
### 4.1 广告位合约
1. 广告位合约是最早产生的在线广告售卖方式。它是指媒体和广告主约定在某一时间内在某些广告位上固定投送该广告主的广告，相应的结算方式为CPT。这种方式的缺点非常明显，即无法做到按受众投放广告，因而也无法进行深入的效果优化
2. 广告位合约方式在一定特定的场景下也有可取之处：
  + 首先，在一些强曝光属性（如手机应用的开屏广告、门户网站首页的一些特型广告位等）的广告位采用这种独占的广告投放，往往可以有效地给用户带来品牌冲击，而在其他一些横幅位置长期独占式的购买，有利于形成“橱窗效应”，塑造不断攀升的品牌价值和转化效果
  + 其次，这种销售模式可以向广告主提供一些额外的附加服务，如同一个页面上的竞品排他，这就使高溢价的流量变现称为可能
3. 广告位合约还有一种变形形式，即按照广告位的轮播售卖。在这种方式中，同一个用户对同一个广告位的一些列访问，被依次标上一组循环轮播序列号，如{1, 2, 3}。将其中具有同样顺序号的展示作为一个虚拟的广告位售卖给广告主。这种轮播的的售卖方式，在广告位独占式售卖库存不够而广告主又需要去定的展现规则保证时，被较广泛地采用，特别是中国门户网站的品牌广告中
### 4.2 受众定向
1. 受众定向本身的重要性和应用范围远远超出合约广告领域，而在各种竞价广告产品中也尤为重要
2. 在考察某种定向方法时，有两个光剑点需要关注：
  + 一是定向的效果，即符合该定向方式的流量高出平均效果的水平
  + 二是定向的规模，即这部分流量占整体广告库存流量的比例
3. 显然，效果好、覆盖率又高的定向方法是我们追求的目标，不过往往难以两全。因此，广告系统有必要同时提供多种定向方法的支持，以达到整体流量上质的最优化
4. 另一个类似的概念是用户画像。对用户刻画的重点往往是当前购物兴趣等直接驱动效果的标签
### 4.2.1 受众定向方法概览
1. 市场上比较流行的定向方式。按照其有效性和在广告信息接收过程中起作用的阶段，分以下常见受众定向方法


[常见受众定向方法一览](https://github.com/JiangRIVERS/ReadingNotes/blob/main/计算广告/常见受众定向方法一览.jpeg)

![image](https://github.com/JiangRIVERS/ReadingNotes/blob/main/计算广告/常见受众定向方法一览.jpeg)

2. 对受众定向的一些典型方法说明如下：
  + 地域定向（geo-targeting）。地域定向也可以被认为是一种上下文定向，不过其计算很简单，仅仅需要简单的查表就可以完成
  + 人口属性定向（demographical targeting）。人口属性的主要标签包括年龄、性别、受教育程度、收入水平等。人口属性有一点与兴趣标签不同，那就是它是可以监测的。如果没有特别的专门数据来源，如实名制SNS的注册信息或在线购购物的消费记录等，一般情况下要准确进行人口属性定向并不容易。在人口属性数据覆盖率不足的情况下，我们可以用已知人口属性的用户作为训练集，构造分类器对人口属性进行自动标注。但准确度有限
  + 上下文定向（contextual targeting）。根据网页或应用的具体内容来匹配相关的广告，这就是上下文定向。上下文定向的粒度可以是关键词、主题，也可以是根据广告主需求确定的分类。在不同类别的内容上，上下文定向的效果有很大的区别。但是，这种方式有一个非常大的好处，那就是覅概率比较高。对大多数广告展示，不论对当前访问用户的信息了解有多少，往往都可以根据当前浏览的页面推测用户的即时兴趣，从而推送相关广告。由于覆盖率高，上下文定向也是ADN中首选的定向方法之一
  + 行为定向（behavioral targeting）。行为定向是根据用户的历史访问行为了解用户兴趣，从而投送相关广告的。行为定向可以被认为是一系列上下文定向的融合结果。因此，上下文定向是行为定向的基础，而且对各种类型的上下文定向，都可以有相对应的行为定向方式
  + 精确位置定向（hyper-local targeting）。在移动设备上投放广告时，我们有可能获得非常精确的地理位置。这也使得大量区域性非常强的小广告主（如餐饮、美容等）有机会投放精确定位的广告。这已经与传统意义上的地域定向有了质的区别，也称为移动广告最重要的机会之一
  + 重定向（retargeting）。这是一种最简单的定制化标签，其原理是对某个广告主过去一段时间内的访客投放广告以提升效果
  + 新客推荐定位（look-alike targeting）。由于重定向的量太小，而且无法满足广告主接触潜在用户的需求，因此不能仅仅依靠它来投送广告。新客推荐定向的思路是根据广告主提供的种子访客信息，结合广告平台更丰富的数据，为广告主找到行为上相似的潜在用户。这一方法的目的是希望在同等用户覆盖率的情况下，达到比依稀通用的兴趣标签更好的效果，这也从实质上体现了广告主数据的核心价值
  + 动态定价（dynamic pricing）。这并不是一种定向广告技术，但却的与其有一定的关联。团购也是一种变相的广告形式，这种广告有两个显著的特点：
    + 首先是一般都针对区域性的广告主，因此其余定向或者直接按照地域分类组织是必要的功能
    + 另外，团购主要是利用价格工具，直接降低用户在决策阶段的门槛，使得对价格敏感的用户转化效果有明显的提升
  + 场景定向（scenario targeting）。场景定向是移动环境下的新问题。移动设备体现了场景上的丰富性。你在使用手机时的背景状态就是场景。另外，移动设备丰富的传感器和状态信息为场景的判断提供了可能
### 4.2.2 受众定向标签体系
1. 在一些反映用户兴趣的受众定向方法（如行为定向、上下文定向）我们需要一个标签系统，将每个用户映射到其中的一个或几个标签上去。这是产品策略中特别关键的一环。一般来说，标签体系有两种组织方式：
  + 一种是按照某个分类法（taxonomy）制定一个层次标签系统，其中上层的标签是下一层的父节点，在人群覆盖上是包含关系。一些面向品牌广告的受众定向，往往采用这种结构化较强的标签体系。需要指出，这一体系中的标签是根据需求方的逻辑而制定的，某些在媒体方意义很大的分类标签，如军事等，由于没有明确的需求对应，不宜出现在标签体系中
  + 另外一种兴趣标签的组织方式，是根据广告主的具体需求设置相应的标签，所有的标签并不能在同一个分类系统中描述，也不存在明确的父子关系。这种半结构化或非结构化的标签体系往往包含一些比较精确地标签集合，因而主要适用于多种目标，特别是效果目标并存的广告主的精确流量选择需求
2. 是选择结构化的兴趣标签系统还是选择非结构化的兴趣标签体系，更多的是商业上的决策，主要考虑下面两种情况：
  + 当标签作为广告投放的直接标的时（包括CPM广告及竞价广告中直接可被广告主选择的人群），这些标签既要能够为广告主所理解，又要方便广告主的选择。因此，在这种情况下，结构化的层级标签体系往往是较合理的产品方案
  + 当标签仅仅是投放系统需要的中间变量，作为CTR预测或者其他模块的变量输入时，结构化的标签体系其实是没有必要的，应该完全按照效果驱动的方式来规划和挖掘标签，而各个标签之间也不太需要层次关系的约束。其目的是追求效果或特殊人群定位，因而组织上的规整性也就让位于效果的准确性了
3. 还有一种特殊的标签形式，即关键词。直接按照搜索或浏览内容的关键词划分人群，往往可以达到比较准确的效果（常见于搜索广告）
### 4.2.3 标签体系的设计思路
1. 标签体系的设计必须要分行业进行，而其中的关键思路是深入研究该行业的用户决策过程。简单来说，就是要洞彻在这个行业里，用户决定买什么、不买什么的原因和逻辑。举例来说：在游戏行业，游戏有与电影和音乐类似的艺术性质，它的用户决策过程总体上不易把握。因为人们对艺术的喜爱并不是理性的，也就难以总结规律。如果直接用RPO、ACT、SLG、RTS、STG这些游戏分类作为标签体系行不行呢？其实这些分类只是为了便于游戏的组织和索引，并不能准确反映用户的决策逻辑。难道一个“RPG游戏爱好者”看到RPG就非玩不可，其他的游戏都不屑一顾吗？显然不是如此。要想把游戏的用户标签做好，就要深入细分的游戏场景中去深入研究。比方说玩老虎机游戏的用户往往经常换不用素材的新游戏，也就是说，将“老虎机爱好者”作为一个用户标签，与用户决策过程是相符的。而喜欢海岛奇兵游戏的用户，对SuperCell新出的游戏也往往心仪，此时“SuperCell”这个品牌就成了有效的用户标签
### 4.3 展示量合约
1. 在今天，即使是以品牌为目的的投放，广告位合约也并非主流。实际上互联网主流的品牌广告投放方式是按照CPM结算的展示量合约。这种合约还有一个名称，就是担保式投送，即GD，其中“担保”指的就是量的约定。在实际执行中，在未能完成合约中的投放量时，可能要求媒体承担一定的赔偿
2. 媒体从按固定广告位售卖变为按CPM售卖，初衷是为了在流量变现的基础上加上数据变现，面向的仍然是原来的品牌广告主。广告主按广告位采买时，比较容易预估自己拿到的流量，可是按照人群定向的方式采买，流量却又诸多不确定的因素。因此，需求方希望在合约中加入对量的保证，才能放心地采买
3. 展示量合约并没有摆脱广告位这一标的物。这是因为在CPM这种结算方式下，无法将多个差别很大的广告位打包成同一售卖标的。因为不同广告位的曝光有效性可能差别巨大，所以合理的CPM也会相应地大幅变动。实践中展示量合约往往是以一些曝光量很大的广告位为基础，再切分人群售卖
4. 虽然从交易模式上看，展示量合约仍然是比较传统的交易模式，但是从技术层面上看，这种模式的出现实际上已经反映了互联网广告计算驱动的本质：分析得到用户和上下文的属性，并由服务端根据这些属性及广告库情况动态决定广告候选。这一商业模式的出现，需要有一系列技术手段的支持
### 4.3.1 流量预测
1. 展示量合约售卖的是某特定人群上的广告曝光次数，而人群不同于确定的广告位，因此必须在合约中约定投放的量。于是就产生了流量预测（traffic forecasting）这一问题。流量预测在广告产品中有以下3个主要用途：
  + 售前指导。在展示量合约广告中，因为要约定曝光总数，所以事先尽可能准确地预测各人群标签的流量直观重要
  + 在线流量分配。同样是在展示量合约广告中，由于合约之间在人群选择上会有很多交集，当一次曝光同时满足两个以上合约的要求时，怎样决策将它分配给哪个合约以达到整体满足所有合约的目的，这是在线分配问题。各种在线分配算法都要依赖流量预测的结果，以达到高效和准确的目的
  + 出价指导。在竞价广告中，由于没有了量的保证，广告主往往需要根据自己预测的出价先了解一下可能获得多少流量，以判断自己的出价是否合理
2. 广告里一般的流量预测问题，可以描述成对流量t(u, b)这个函数的估计，其中第一个参数u是给定的人群标签或人群标签的组合，第二个参数b是出价
### 4.3.2 流量塑性
1. 流量预测对于展示量合约非常重要，不过这本质上还是被动地统计流量的情况。在有些情形下，我们可以主动地影响流量，以利于合约的达成。这一产品策略问题称为流量塑性（traffic shaping）
2. 流量塑性的典型场景可以参考门户网站上售卖的展示量合约广告。门户网站各子频道的流量严重依赖于首页关键位置链接的导流。假如在车展期间，汽车频道上的展示广告需求旺盛，那么首页上的链接应该更多地给汽车频道导流以利于收入的增加。这样的想法相当直接，在实际中也被广泛地使用。不过，从商业产品的要求来看，要系统化、高效率地达到流量塑性的目标，需要将用户产品与广告产品的需求情况打通，然后按照一定的准则，在不伤害用户体验的情况下，尽可能提高商业变现的效率。
3. 流量塑性问题已经涉及用户产品与商业产品的内在联系
### 4.3.3 在线分配
1. 展示量合约这种保量合约会面临一个问题：各个合约要求的人群很可能大量交叠，如何设计分配策略，使得各个合约都尽可能被满足，为了描述这一策略问题，我们将其简单化为一个二部图（bipartite graph）匹配问题

[在线分配中的二部图匹配问题示意](https://github.com/JiangRIVERS/ReadingNotes/blob/main/计算广告/在线分配中的二部图匹配问题示意.jpeg)

![image](https://github.com/JiangRIVERS/ReadingNotes/blob/main/计算广告/在线分配中的二部图匹配问题示意.jpeg)

2. 在线分配需要根据历史数据和某种策略，离线得到一个分配方案，线上则照此方案执行
3. 随着标签数量的增加，供给节点的数量会以指数速度上升，而每一个供给节点的流量当然也就迅速收缩。当节点流量过小时，对其进行准确的预测就变得相当困难，这时上面所说的方案就会变得完全不可行。因此，展示量合约这类广告在人群标签非常丰富和精准时，是无法有效地运作的，而这正是竞价广告产品的原动力之一
### 4.3.4 产品案例
1. 合约广告的尴尬：大量精确的标签在合约量的约束下基本无法售卖
2. 一个广告产品声称自己的标签体系多么复杂，有多少标签种类，这些在实际上没有太大的意义，而这些标签的人群规模才更有说服力
## 第5章 搜索广告与竞价广告
1. 随着搜索业务变现的要求，以及精准受众定向技术的发展，在搜索广告和展示广告中都产生了竞价这种交易模式
2. 竞价交易模式的本质是将量的约束从交易过程中去除，仅仅采用”价高者得“的简单决策方案来投放广告。竞价顺应了定向广告向精细化发展的趋势要求，也为无法用合约售卖的剩余流量找到了可能的变现渠道，使大量中小广告主参与在线广告的可能性和积极性大大增加，也使在线广告的商业环境与传统广告的商业环境有了本质区别
3. 搜索广告在竞价广告乃至整个在线广告中都居于旗舰产品的位置。除了它的变现能力和市场规模方面的优势，更重要的是，一些在线广告中非常核心的产品策略和技术方案都来源于搜索广告。因此，对搜索广告的深入理解，对理清整个竞价广告市场非常关键
4. 在竞价的交易逻辑下，展示广告领域也产生了广告网络这种批量采购各种媒体剩余流量，然后按照点击付费的方式售卖给广告主的产品形式
5. 广告网络中经济的标的有两种：
  + 一是上下文页面中的关键词，这是直接从搜索广告衍生而来的
  + 二是根据用户行为加工的兴趣标签，这是从展示广告的定向逻辑发展而来的
6. 广告网络的竞价环境与搜索广告有所不同：各种上下文或用户标签的有效性差别巨大，另外各种广告位的差别也会很大。因此，除了完全按照eCPM估计排序广告外，冷启动问题以及各种复杂环境下点击率的归一化非常重要
7. 而对竞价广告的产生，需求方的产品和技术也在发生变化。其中关键的变化有两点：
  + 一是由面向广告位采买变成面向人群的跨网络采买
  + 二是帮助广告主在竞价环境中完成量的保证，而这一点是竞价市场本身不再保证的
8. 能达到这些需求方目的的产品，我们称其为媒体采买平台
9. 在媒体采买平台里，在量的约束下完成ROI优化的问题依然存在，并且变得比在线分配问题更加困难，ROI优化也称为高端采买平台提供的服务之一
10. 当然，搜索广告的媒体采买和ROI优化同样十分重要，这项专门的服务被称为搜索引擎营销（Search Engine Marketing, SEM）
### 5.1 搜索广告
1. 搜索广告是典型的竞价广告产品，其有点事广告主就某标的物（在这里是关键词）的广告展示机会展开拍卖式的竞争，并根据竞争结果依次占据该广告展示的若干位置。这与展示量合约是截然不同的：首先，量的保证不复存在，广告主需要自行调整调整效果与量的平衡；其次，价格的约定也被去掉，每个广告主都可以是随时调整整个关键词的出价
### 5.1.1 搜索广告产品形态
1. 搜索广告是以查询词为粒度进行受众定向，并按照竞价方式售卖、按CPC结算的广告产品
2. 搜索广告最基本的形式是与自然检索结果一致的文字链，一般会加底色和角上的”推广“”推广链接“”ADs“等字样，以区别于自然结果，这样做的目的是让那些对广告没有兴趣的人尽量减少误点率，从而降低广告主的无效消费和提升用户体验
3. 由于移动搜索结果一般简单组织成信息流的形式，移动搜索广告的形式比PC搜索广告要简单：在通用搜索中，广告往往出现在最上面或最下面，并没有东区的存在；在一些垂直搜索中，广告则可能穿插在内容里
4. 搜索广告竞价的标的物是竞价关键词（bid term）。用户输入的查询（query）通过与关键词相匹配，来确定是否可以触发该条广告。匹配的方式既可以采取简单的精确匹配，也可以有很多的扩展方式，这称为查询扩展，是搜索广告的一项比较关键的产品策略
5. 在互联网广告的整个产品谱系当中，搜索广告有着特别重要的地位，具有以下一些鲜明的产品产品和技术特点：
  + 搜索广告的变现能力，即oCPM远远高于一般的展示广告，其市场重要程度也就得以彰显。搜索广告高变现能力最关键的产品原因就是，用户主动输入的查询直接反映了用户的意图
  + 搜索广告的受众定向标签，即使上下文的搜索查询。由于搜索词非常强地表征着用户的意图，因此搜索广告可以进行给常精确的定位。相对于搜索词，根据用户历史行为得到的兴趣标签的重要性大打折扣，这一方面是因为其信号远不如搜索词强烈，另一方面是因为用户这样明确意图的任务是不能被打断的。因此，搜索广告里的eCPM由一般情况下的r(a, u, c)退化成了r（a, c）,其中a为广告，u为用户，c为上下文
  + 搜索广告的展示形式与自然结果的展示形式非常接近，往往仅在底色和文字链接中有不太引人瞩目的提示。这样的产品设计使得它有原生广告的意味，也进一步提高了广告效果。但是，这样的广告结果对相关性的要求远远超过展示广告，因此在根据查询匹配广告时需要非常精细的策略和技术
  + 从搜索广告发展起来的竞价交易模式，已经成为互联网广告最主流的交易模式
### 5.1.2 搜索广告产品新形式
1. 搜索广告有以下3个方面的探索趋势：
  + 丰富文字链创意的展示形式，让其更富有表现力以提高点击率
  + 利用东区对相关性稍低的特点，设计一些拓展广告产品。当然，这种探索并不适用于移动搜索广告
  + 优化广告与自然结果的关系，在保证相关性和广告效果的前提下提高收入
2. 具体说明3个探索趋势
  + 超越文字链的创意。搜索广告也在探索一些能传递更多价值的展示形式，以同时提升用户体验和变现效率。这方面的探索有以下两个重点方向：
    + 在通用广告链接上增加更多有表现力的信息点。除标题、摘要这些文字链广告创意的标准内容意外，还增加了广告主的Logo、主要内容链接、联系电话等内容。这些都会提高广告的直接效果和品牌价值。更重要的是，这样的发展方向与行业基本无关，可以规模化复制
    + 直接展示结构化的广告内容摘要，甚至提供一些可直接访问的内容，这样可以减少用户跳转的成本提高推广效率。需要指出，这种内容为了照顾用户体验的一致性，往往不能完全采用搜索广告的竞价方式来运营，一般的运营方式是就某个行业进行阶段性的线下竞价。上面这种发展方向为提升搜索广告效果提供了新的空间，然而尚未成为搜索广告的主流。原因在于这种模式需要分行业设计产品和运营方案，规模化程度有限；另外如果直接对接单品，会产生与个性化重定向一样的商品库对接等复杂的工程问题
  + 弱相关广告形式。在合理和可解释的范围内可以增加一点相关要求稍低的泛化内容。我们用两个例子来介绍这方面的探索：
    + 在搜索广告中常见的带有一定品牌意味的广告形式是以广告主对应的一组导航类搜索关键词，在用户搜索这些关键词时展示该广告主的品牌宣传创意。这样的产品，可以提升广告主用户对品牌的认知程度和后续黏性（类似于海报形式）
    + 搜索引擎提供的同类推荐功能。通过已有广告产品，可以为搜索引擎提供一些离决策稍远、以接触潜在用户为目的的广告。这样的产品绝对不能在搜索左侧的结果中展示，因为那样会引起用户对结果相关性的质疑
  + 原生化探索。搜索广告从一开始就具有原生广告的特点：它的商业化结果与自然结果一样，由用户的主动意图触发，并且在展示形式上与自然结果相差不大。中国的搜索广告有混排在自然结果中的竞价排名方式。另外一个原生化的趋势是，在有些直接面向商品的信息类搜索中（例如，直接百度搜索”月饼“），在其中混入商业化结果，并进行统一排序。与只提供自然结果相比，这可以增强变现能力；与只提供广告结果相比，这可以避免需求不足带来的结果质量下降。这样的广告，也可称为”商品直达式广告“
3. 我们认为，搜索广告是比信息流广告更重要的原生广告起源，而且搜索广告的一些特点可以被借鉴到原生广告产品中
### 5.1.3 搜索广告产品策略